{"id":18,"name":"EXCEL ЭИ и ФК по пластинам Малой сборки","footnote_sql_ora":"","footnote_sql_pg":"","caption_sql_ora":"","caption_sql_pg":"","sql_ora":"/*\n\"columns\": [0, 1,2,3,4,5,6,7]\n*/\n\nSELECT\n  q2.good_name  AS \" Изделие \",\n  q2.rl_number AS \"№ СЛИ\", \n  q2.rl_number || '#' || q2.RL_COMMENT AS \"Комментарий СЛИ\",\n  q2.rl_number || '#' || q2.RLO_DIRECTIVE AS \"Указания технолога\",\n  q2.rl_number || '#' || q2.RLO_COMMENT AS \"Коментарий оператора\",\n  q2.dw_waf_id AS \"№ пластины\",\n  q2.dw_waf_id || '#' || q2.matched_ms AS \"№ Мал.сб.\", \n  q2.dw_waf_id || '#' || q2.c100 AS \"Годные\"\nFROM\n(  \n\n  SELECT \n    q3.RLO_DIRECTIVE, \n    q3.RLO_COMMENT, \n    q3.RL_COMMENT,\n    q3.good_name,\n    q3.bl_name, \n    q3.rl_number, \n    q3.dw_waf_id, \n    q3.matched_ms,\n    sum(q3.c100) as c100,\n    sum(q3.co) as c0\n  FROM\n  (\n\n -- P32122-02-A2\n \n    SELECT\n      q.RLO_DIRECTIVE, \n      q.RLO_COMMENT, \n      q.RL_COMMENT,\n      q.good_name,\n      q.bl_name, \n      q.rl_number, \n      q.dw_waf_id, \n      q.matched_ms,\n      --q.DWMH_ID,\n      -- q.count_DWMH_ID,\n      CASE WHEN q.DWMH_ID = 100 THEN\n        q.count_DWMH_ID\n      ELSE\n        0\n      END AS c100 ,\n      CASE WHEN q.DWMH_ID != 100 THEN\n        q.count_DWMH_ID\n      ELSE\n        0\n      END AS co\n    FROM \n  (\n    SELECT    \n      eii.RLO_DIRECTIVE, \n      eii.RLO_COMMENT, \n      eii.RL_COMMENT,\n      eii.good_name,\n      eii.bl_name, \n      eii.rl_number, \n      eii.rl_id, \n      eii.dw_waf_id, \n      eii.DW_ID ,\n      ms2.rl_number  as matched_ms,\n      wmp.dwm_id,\n      mct.DWMH_ID,\n      count(mct.DWMH_ID) AS count_DWMH_ID\n    FROM\n      ( \n        SELECT  -- ms.*, ei.*, ei2.* -- ,\n          DISTINCT\n          ei2.RLO_DIRECTIVE, \n          ei2.RLO_COMMENT, \n          ei2.RL_COMMENT,\n          ei2.good_name,\n          ei2.bl_name, \n          ei2.rl_number, \n          ei2.rl_id, \n          ei2.dw_waf_id, \n          ei2.DW_ID \n        FROM \n        (\n          -- малая сборка - листы, выбранные из планопа\n          SELECT\n            --SPLIT_PART(SPLIT_PART(bl.bl_name, ' ',1), '.',1) good_name,\n            REGEXP_SUBSTR (REGEXP_SUBSTR (bl.bl_name, '[^ ]+', 1), '[^.]+',  1) good_name,\n            bl.bl_name,\n            rl.rl_number,\n            w.dw_waf_id,\n            w.DW_ID\n          FROM\n            a_route_lists rl,\n            a_base_lists bl,\n            a_route_list_o rlo,\n            a_route_list_o_u_start rloust,\n            d_wafer w\n          WHERE\n            bl.bl_id = rl.bl_id\n            --AND upper(bl.bl_name)  LIKE upper('%малая сборка%')\n            AND rlo.rl_id = rl.rl_id\n            AND rlo.rlo_number = 1\n            AND rloust.rlo_id = rlo.rlo_id\n            AND w.dw_id = rloust.u_id\n            AND rl.RL_NUMBER in ( 11368,11606,11607,11630,11631,8930,10751,10755,10756,10770,10771,10814,10815,11235,11323,11324,11325,11326,11327,11433,11605,11643,11766,12099 )   \n        ) ms \n\n        LEFT OUTER JOIN\n        (\n          -- листы ЭИ для пластин выбранных листов малой сборки\n          SELECT\n            --SPLIT_PART(SPLIT_PART(bl.bl_name, ' ',1), '.',1) good_name,\n            REGEXP_SUBSTR (REGEXP_SUBSTR (bl.bl_name, '[^ ]+', 1), '[^.]+', 1) good_name, bl.bl_name, rl.rl_number, rl.rl_id,\n            w.dw_waf_id , w.DW_ID --, rlolast.RLO_DIRECTIVE, rlolast.RLO_COMMENT, rl.RL_COMMENT, rl.RL_COMMENT_2, rl.RL_COMMENT_3\n          FROM\n            a_route_lists rl,\n            a_base_lists bl,\n            a_route_list_o rlo,\n            a_route_list_o_u_start rloust,\n            d_wafer w\n          WHERE\n            bl.bl_id = rl.bl_id\n            AND upper(bl.bl_name)\n            LIKE upper('%ЭИ и ФК%')\n            AND rlo.rl_id = rl.rl_id\n            AND rlo.rlo_number = 1\n            AND rloust.rlo_id = rlo.rlo_id\n            AND w.dw_id = rloust.u_id\n        ) ei \n          ON ei.dw_id = ms.dw_id -- связь по id пластины\n\n        LEFT OUTER JOIN\n        (\n          SELECT\n            --SPLIT_PART(SPLIT_PART(bl.bl_name, ' ',1), '.',1) good_name,\n            REGEXP_SUBSTR (REGEXP_SUBSTR (bl.bl_name, '[^ ]+', 1), '[^.]+', 1) good_name, \n            bl.bl_name, rl.rl_number, rl.rl_id, w.dw_waf_id, w.DW_ID, rlolast.RLO_DIRECTIVE, rlolast.RLO_COMMENT, rl.RL_COMMENT || ' ' || rl.RL_COMMENT_2 || ' ' || rl.RL_COMMENT_3 as RL_COMMENT\n          FROM\n            a_route_lists rl,\n            a_base_lists bl,\n            a_route_list_o rlo,\n            a_route_list_o_u_start rloust,\n            d_wafer w,\n            a_route_list_o rlolast\n          WHERE\n            bl.bl_id = rl.bl_id\n            AND upper(bl.bl_name)\n            LIKE upper('%ЭИ и ФК%')\n            AND rlo.rl_id = rl.rl_id\n            AND rlo.rlo_number = 1\n            AND rloust.rlo_id = rlo.rlo_id\n            AND w.dw_id = rloust.u_id\n            AND rlolast.rl_id = rl.rl_id\n            AND rlolast.rlo_number = (\n              SELECT\n                max(rlo_number)\n              FROM\n                a_route_list_o\n              WHERE\n                rl_id = rl.rl_id)\n        ) ei2 \n          ON ei2.rl_id = ei.rl_id\n\n    --   ORDER BY  ei2.good_name,ei2.rl_number, ei2.dw_waf_id\n      ) eii\n      LEFT OUTER JOIN \n      (\n        -- малая сборка - листы, выбранные из планопа второй раз, чтобы избежать удвоений\n        SELECT\n          rl.rl_number,\n          w.dw_waf_id,\n          w.DW_ID\n        FROM\n          a_route_lists rl,\n          a_route_list_o rlo,\n          a_route_list_o_u_start rloust,\n          d_wafer w\n        WHERE\n            rlo.rl_id = rl.rl_id\n          AND rlo.rlo_number = 1\n          AND rloust.rlo_id = rlo.rlo_id\n          AND w.dw_id = rloust.u_id\n          AND rl.RL_NUMBER in ( 11368,11606,11607,11630,11631,8930,10751,10755,10756,10770,10771,10814,10815,11235,11323,11324,11325,11326,11327,11433,11605,11643,11766,12099 )   \n      ) ms2\n      ON ms2.DW_ID = eii.DW_ID,\n      d_wafer_map wmp, \n      d_wafer_map_content mct\n    WHERE \n        wmp.dw_id = eii.dw_id\n        AND wmp.dwm_number = 2\n        AND mct.dwm_id = wmp.dwm_id  \n    GROUP BY\n      eii.RLO_DIRECTIVE, \n      eii.RLO_COMMENT, \n      eii.RL_COMMENT,\n      eii.good_name,\n      eii.bl_name, \n      eii.rl_number, \n      eii.rl_id, \n      eii.dw_waf_id, \n      eii.DW_ID ,\n      ms2.rl_number,\n      wmp.dwm_id,\n      mct.DWMH_ID\n   -- ORDER BY  eii.good_name,eii.rl_number, eii.dw_waf_id  \n\n\n\n\n  \n  \n\n  )q\n\n  --  where q.dw_waf_id = 'P32122-02-A2'\n \n  )q3\n  GROUP BY\n   q3.RLO_DIRECTIVE, \n    q3.RLO_COMMENT, \n    q3.RL_COMMENT,\n    q3.good_name,\n    q3.bl_name, \n    q3.rl_number, \n    q3.dw_waf_id, \n    q3.matched_ms\n  \n  ORDER BY \n  q3.good_name,\n  q3.rl_number,\n  q3.dw_waf_id\n  \n\n  \n)q2\nORDER BY\nq2.good_name,\nq2.rl_number,\nq2.dw_waf_id\n","sql_pg":"","comment":"{\n  \"type\":\"EXCEL\",\n  \"rowspanizer\":{\n    \"columns\": [0, 1,2,3,4,5,6,7]\n  }\n}","execdb":0,"param":"[ ]"}